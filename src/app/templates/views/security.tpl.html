<div id="pm_settings">

    <ng-include src="'templates/partials/menu.settings.tpl.html'"></ng-include>

    <div class="settings" pt-height>

        <div class="row">

            <section class="setting pm_form full">

                <form>
                    <legend>{{ 'KEY_EXPORT' | translate }}</legend>
                    <p>Download your Public Key for use with other PGP compatible services. Only incoming messages in inline OpenPGP format are currently supported.</p>

                    <p class="alert alert-info" ng-show="isSafari">Safari doesn't support downloading of keys. We are working on a fix for this.</p>

                    <p>
                        <button ng-click="exportPublicKey($event)" class="pm_button" ng-disabled="isSafari">
                            <i class="fa fa-key"></i> <strong>{{ 'DOWNLOAD_PUBLICKEY' | translate }}</strong>
                        </button>
                    </p>

                    <p>&nbsp;</p>

                </form>

            </section>

            <section class="setting pm_form full">

                <form>
                    <legend>{{ 'AUTHENTICATION_LOGS' | translate }}</legend>

                        <div class="pull-right" id="logActions" ng-hide="doLogging == 0">
                            <a class="pm_button pull-left" ng-click="clearLogs()">
                                <i class="fa fa-times"></i> <strong>{{ 'CLEAR_LOGS' | translate }}</strong>
                            </a>
                            <a class="pm_button pull-left" ng-click="downloadLogs()">
                                <i class="fa fa-download"></i> <strong>{{ 'DOWNLOAD_LOGS' | translate }}</strong>
                            </a>
                            <span ng-show="(logCount > logItemsPerPage)">
                                <paginator page="currentLogPage" total-items="logCount" items-per-page="logItemsPerPage" change="loadLogs" />
                            </span>
                        </div>

                        <a class="pm_button pull-left" id="logRefresh" ng-class="{ 'disabled': doLogging == 0 }" ng-click="initLogs()">
                            <i class="fa fa-rotate-right"></i>
                        </a>

                        <div class="pm_buttons pull-left">
                            <a ng-class="{'active': doLogging === 0}" ng-click="setLogging(0)">
                                <strong>{{ disabledText }}</strong>
                            </a>
                            <a ng-class="{'active': doLogging === 1}" class="divider" ng-click="setLogging(1)">
                                <strong>{{ 'BASIC_LOGGING' | translate }}</strong>
                            </a>
                            <a ng-class="{'active': doLogging === 2}" class="divider" ng-click="setLogging(2)">
                                <strong>{{ 'ADVANCED_LOGGING' | translate }}</strong>
                            </a>
                        </div>

                        <div id="logArea" ng-show="doLogging != 0" class="clear">

                            <p class="alert alert-info" ng-show="logs.length<1">No logs yet.</p>

                            <table class="pm_table hidden-xs" id="accessLog" ng-init="initLogs()" ng-show="logs.length>0">
                                <thead>
                                    <tr>
                                        <th>{{ 'EVENT' | translate }}</th>
                                        <th>{{ 'TIME' | translate }}</th>
                                        <th ng-show="doLogging == 2" class="text-right">IP</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="log in logs | limitTo: logItemsPerPage: currentLogPage*logItemsPerPage" ng-class="{ 'danger': (log.Event == 0) }">
                                        <td scope="row">
                                            <span ng-show="{{ log.Event == 0 }}"><i class="fa fa-times-circle"></i> {{ 'LOGIN_FAILED' | translate }}</span>
                                            <span ng-show="{{ log.Event == 1 }}"><i class="fa fa-check"></i> {{ 'LOGIN_SUCCESS' | translate }}</span>
                                            <span ng-show="{{ log.Event == 2 }}"><i class="fa fa-check"></i> {{ 'LOGOUT' | translate }}</span>
                                        </td>
                                        <td>
                                            {{ log.Time * 1000 | date : 'medium' }}
                                        </td>
                                        <td ng-show="doLogging == 2" class="text-right">
                                            <kbd ng-show="log.IP!==''">{{ ::log.IP }}</kbd>
                                            <kbd ng-show="log.IP===''">--</kbd>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                </form>

            </section>

    </div><!--/.settings-->

</div><!--/#pm_settings-->
