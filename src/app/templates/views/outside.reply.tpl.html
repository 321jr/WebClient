<div id="outsideMessageWrap">
    <div class="message-head" ng-class="{ unread:!message.IsRead, starred: message.Starred === 1 }">
        <div class="pull-right">
            <span btf-markdown="message.longReadableTime() | contrast:'('"></span>
        </div>
        <h1>
            <a href class="star" ng-click="toggleStar(message)"><i class="fa {{ (message.Starred === 1) ? 'fa-star' : 'fa-star-o' }}"></i></a>
            <span class="padlock">
                <i class="fa"
                ng-class=
                "{
                  'fa-lock':
                    !!!(message.IsEncrypted == '0'),
                  'text-purple':
                    !!(message.IsEncrypted == '1') ||
                    !!(message.IsEncrypted == '5') ||
                    !!(message.IsEncrypted == '6'),
                  'fa-unlock-alt text-muted':
                    !!(message.IsEncrypted == '0')
                }"
                title="{{ getMessageEncryptionType(message) }}"></i>
            </span>
            <span class="attachement" ng-show="message.Attachments.length > 0">
                <i class="fa fa-paperclip"></i>
            </span>
            {{ message.Subject }}
            <span class="label label-pm" style="background-color: {{ getLabel(id).Color }}" ng-repeat="id in message.LabelIDs">
                {{ getLabel(id).Name }} <a href="" ng-click="detachLabel(id)"><i class="fa fa-times"></i></a>
            </span>
          </h1>
        <ul class="infos">
            <li>
                <strong>{{ 'FROM' | translate }}</strong>
                <i class="fa fa-lock text-purple" ng-if="tools.isEmailAddressPM(message.SenderAddress)"></i>
                <b>{{message.SenderName}}</b> &lt;{{message.SenderAddress}}&gt;
                <span class="fa fa-check-circle verified" pt-tooltip="ProtonMail Verified" ng-if="message.IsEncrypted==CONSTANTS.ENC_INTERNAL||message.IsEncrypted==CONSTANTS.ENC_OUT_ENC_REPLY"></span>
                <span class="fa fa-check-circle verified" pt-tooltip="DKIM is Valid" ng-if="tools.is_valid_dkim(message.Header)"></span>
            </li>
            <li>
                <strong>{{ 'TO' | translate }}</strong>
                <ul class="list-inline inline" ng-if="message.ToList.length">
                    <li ng-repeat="email in message.ToList">
                        <a href="" class="email" ng-click="sendMessageTo(email)" pt-tooltip="{{ 'COMPOSE' | translate }}"><i ng-show="tools.isEmailAddressPM(email.Address)" class="fa fa-lock text-purple"></i> {{ email.Address }}</a>
                    </li>
                </ul>
            </li>
            <li ng-if="message.CCList.length > 0">
                <strong>{{ 'CC' | translate }}</strong>
                <ul class="list-inline inline">
                    <li ng-repeat="email in message.CCList">
                        <a href="" class="email" ng-click="sendMessageTo(email)" pt-tooltip="{{ 'COMPOSE' | translate }}"><i ng-show="tools.isEmailAddressPM(email.Address)" class="fa fa-lock text-purple"></i> {{ email.Address }}</a>
                    </li>
                </ul>
            </li>
            <li ng-if="message.BCCList.length > 0">
                <strong>{{ 'BCC' | translate }}</strong>
                <ul class="list-inline inline">
                    <li ng-repeat="email in message.BCCList">
                        <a href="" class="email" ng-click="sendMessageTo(email)" pt-tooltip="{{ 'COMPOSE' | translate }}"><i ng-show="tools.isEmailAddressPM(email.Address)" class="fa fa-lock text-purple"></i> {{ email.Address }}</a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <!--/.message-head-->
    <div ng-show="message.containsImage === true" class="alert alert-warning text-center" ng-show="!!message.imagesHidden" id="showImages">
        <a href="" ng-click="toggleImages()">
            <span ng-show="!!message.imagesHidden">{{ 'SHOW_IMAGES' | translate }}</span>
            <span ng-hide="!!message.imagesHidden">{{ 'HIDE_IMAGES' | translate }}</span>
        </a>
    </div>
    <div id="message-body">
        <squire ng-model="message.Body" message="message" editor="message.editor" height="320px"></squire>
        <div class="email" ng-class="{'plain': isPlain}" ng-init="message.viewMode = 'html';displayContent();" ng-show="message.viewMode === 'html'" ng-bind-html="content"></div>
        <pre class="email" ng-show="message.viewMode === 'plain'" ng-bind="message.plainText()"></pre>
        <div class="alert alert-danger clearfix" role="alert" ng-if="message.failedDecryption">
            <span class="pull-left fa fa-exclamation-triangle"></span>
            <strong>Decryption error</strong>
            <br> Decryption of this message's encryption content failed.
        </div>
    </div>

    <div class="panel panel-default" ng-if="message.Attachments.length" id="attachmentArea">
        <div class="panel-heading">
            <strong>{{ 'ATTACHMENTS' | translate }}</strong> ({{message.Attachments.length}} <span ng-hide="message.Attachments.length === 1">{{ 'FILES' | translate }}</span><span ng-show="message.Attachments.length === 1">{{ 'FILE' | translate }}</span>, {{ sizeAttachments() | humanSize }})
        </div>
        <div class="panel-body">
            <div class="list-group">
                <a ng-repeat="attachment in message.Attachments" class="list-group-item" ng-class="{ 'disabled': attachment.decrypting, 'list-group-item-info': attachment.decrypted }" data-download-text="{{ 'DOWNLOAD' | translate }}" href ng-click="decryptAttachment(message, attachment, $event)">
                    <i ng-show="attachment.decrypting" class="fa fa-cog fa-spin"></i>
                    <i ng-show="attachment.decrypted" class="fa fa-download"></i>
                    <i ng-show="!attachment.decrypting && !attachment.decrypted" class="fa fa-lock"></i>
                    <strong>{{ attachment.Name }}</strong> ({{attachment.Size | humanSize}})
                </a>
            </div>
        </div>
    </div>

    <div class="well text-right">
        <button class="btn btn-default btn-sm pull-left">{{ 'CANCEL' | translate }}</button>
        <button class="btn btn-sm btn-primary" ng-disabled="networkActivity.loading()" ng-click="send(message)" pt-tooltip="{{ 'SEND_MESSAGE' | translate }}">{{ 'REPLY' | translate }}</button>
    </div>

</div>
