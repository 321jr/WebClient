<ng-include ng-if="!('secured.*.message' | includedByState)" src="'templates/partials/messageListToolbar.tpl.html'" class="hidden-xs message-list-toolbar"></ng-include>
<table ng-if="!('secured.*.message' | includedByState)" class="table message-list hidden-xs" ng-class="{empty: messages.length == 0}">
    <tbody id="message">
        <tr ng-repeat="message in messages"
            ng-click="navigateToMessage($event, message)"
            data-drag="true"
            jqyoui-draggable="{onStart: 'onStartDragging(message)', onStop: 'onEndDragging(message)'}"
            data-jqyoui-options="draggableOptions"
            ng-class="{ unread: message.IsRead === 0, selected: message.Selected, starred: message.Starred === 1, encrypted: message.IsEncrypted == '1' }"
            ng-init="message.Location=randLocation()">
            <td class="actions">
                <input type="checkbox" ng-model="message.Selected" ng-click="onSelectMessage($event, message)" />
                <span class="fa" ng-class="{
              'fa-lock':
                !!!(message.IsEncrypted == '0'),
              'text-purple':
                !!(message.IsEncrypted == '1') ||
                !!(message.IsEncrypted == '5') ||
                !!(message.IsEncrypted == '6'),
              'fa-unlock-alt':
                !!(message.IsEncrypted == '0')
            }" title="{{ getMessageEncryptionType(message) }}"></span>
                <a href ng-click="toggleStar(message)">
                    <span class="fa {{ (!!message.Starred) ? 'fa-star' : 'fa-star-o' }}"></span>
                </a>
            </td>

            <td class="recipient">
                <!-- TODO: use message.Location to show "From" & "To" & location icons -->
                <span ng-if="showTo(message)">
                    <span class="to" pt-tooltip="{{ message.ToList | lowercase }}">
                        To: </span>{{ message.ToList | username }}
                    </span>
                </span>
                <span ng-if="showFrom(message) && !showTo(message)">
                    <span class="from" pt-tooltip="{{ message.SenderAddress | lowercase }}">
                        From: </span>{{ message.SenderName }}
                    </span>
                </span>
                <span ng-if="!showTo(message) && !showFrom(message)">
                    <span pt-tooltip="{{ message.SenderAddress | lowercase }}">
                        {{ message.SenderName | username }}
                    </span>
                </span>
            </td>

            <td class="subject">
                <i class="fa fa-clock-o" ng-show="message.ExpirationTime > 0"></i>
                <i class="fa fa-paperclip" ng-show="message.HasAttachment"></i>
                <h4>{{ message.Subject }}</h4>
                <span ng-repeat="id in message.LabelIDs" class="label label-pm" style="background-color: {{ getLabel(id).Color }}">{{ getLabel(id).Name }}</span>
            </td>

            <td class="size">
                {{ message.Size | humanSize }}
            </td>

            <td class="when">
                {{ message.readableTime() }}
            </td>
        </tr>
    </tbody>
</table>

<table ng-if="!('secured.*.message' | includedByState)" class="visible-xs-block table message-list table-hover mobile" ng-class="{empty: messages.length == 0}">
    <tbody id="message">
        <tr ng-repeat="message in messages" ng-click="navigateToMessage($event, message)" ng-class="{ unread: !message.IsRead, selected: selected, starred: message.Tag == 'starred' }">
            <td class="subject">
                <h4>
                    <span class="fa {{ message.IsEncrypted == '1' ? 'fa-lock' : 'fa-unlock-alt' }}" pt-tooltip="{{ message.IsEncrypted == '1' ? 'Encrypted' : 'Not encrypted' }}">
                    </span>{{ message.Subject }}
                </h4>
                <div class="recipient" ng-switch="('secured.sent' | isState) || ('secured.drafts' | isState)">
                    <span ng-if="showTo(message)">
                        <span class="to">
                            To: </span>{{ message.ToList | username }}
                        </span>
                    </span>
                    <span ng-if="showFrom(message) && !showTo(message)">
                        <span class="from">
                            From: </span>{{ message.SenderName }}
                        </span>
                    </span>
                    <span ng-if="!showTo(message) && !showFrom(message)">
                        <span pt-tooltip="{{ message.SenderAddress | lowercase }}">
                            {{ message.SenderName | username }}
                        </span>
                    </span>
                    <span class="pull-right">{{ message.readableTime() }}</span>
                    <span class="sender" ng-switch-default>{{ message.Sender }}</span>
                </div>
            </td>

        </tr>
    </tbody>
</table>

<ui-view></ui-view>
