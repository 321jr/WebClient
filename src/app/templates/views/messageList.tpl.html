<ng-include src="'templates/partials/header.tpl.html'" id="header"></ng-include>

<ng-include src="'templates/partials/messageListToolbar.tpl.html'" class="hidden-xs message-list-toolbar" id="messageListToolbar"></ng-include>
<div id="content">
    <table class="table message-list hidden-xs" ng-class="{empty: messages.length == 0, searchResults: ('secured.search' | includedByState)}">
        <tbody id="message">
            <tr ng-repeat="message in messages"
                ng-click="navigateToMessage($event, message)"
                data-drag="true"
                jqyoui-draggable="{onStart: 'onStartDragging(message)', onStop: 'onEndDragging(message)'}"
                data-jqyoui-options="draggableOptions"
                ng-class="{ unread: message.IsRead === 0, selected: message.Selected, starred: message.Starred === 1, encrypted: message.IsEncrypted == '1' }">
                <td class="actions">
                    <input type="checkbox" ng-model="message.Selected" ng-click="onSelectMessage($event, message)" />
                    <!--
                    ENC_NONE: 0,
                    ENC_INTERNAL: 1, // all within ProtonMail
                    ENC_EXTERNAL: 2, // encrypted from outside
                    ENC_OUT_ENC: 3, // encrypted for outside
                    ENC_OUT_PLAIN: 4, // sent plain but stored enc
                    ENC_STORED_ENC: 5, // such as draft
                    ENC_OUT_ENC_REPLY: 6, // encrypted for outside
                    -->
                    <span
                    class="fa"
                    ng-class="{
                    'fa-lock':
                    !!!(message.IsEncrypted == '0'),
                    'text-purple':
                    !!(message.IsEncrypted == '1') ||
                    !!(message.IsEncrypted == '3') ||
                    !!(message.IsEncrypted == '5') ||
                    !!(message.IsEncrypted == '6'),
                    'fa-unlock-alt':
                    !!(message.IsEncrypted == '0')
                    }"
                    title="{{ getMessageEncryptionType(message) }}"></span>
                    <a href ng-click="toggleStar(message)">
                        <span class="fa {{ (!!message.Starred) ? 'fa-star' : 'fa-star-o' }}"></span>
                    </a>
                </td>
                <td class="recipient">
                    <!-- TODO: use message.Location to show "From" & "To" & location icons -->
                    <span ng-if="showTo(message)">
                        <span class="to" pt-tooltip="{{ message.ToList | username }}">
                            To: {{ message.ToList | username }}
                        </span>
                    </span>
                    <span ng-if="showFrom(message) && !showTo(message)">
                        <span class="from" pt-tooltip="{{ message.SenderAddress }}">
                            From: {{ message.SenderName | username }}
                        </span>
                    </span>
                    <span ng-if="!showTo(message) && !showFrom(message)">
                        <span pt-tooltip="{{ message.SenderAddress }}">
                            {{ message.SenderName || message.SenderAddress }}
                        </span>
                    </span>
                </td>
                <td class="subject">
                    <i class="fa fa-reply" ng-show="message.IsReplied === 1"></i>
                    <i class="fa fa-reply-all" ng-show="message.IsRepliedAll === 1"></i>
                    <i class="fa fa-mail-forward" ng-show="message.IsForwarded === 1"></i>
                    <i class="fa fa-clock-o" ng-show="message.ExpirationTime > 0"></i>
                    <i class="fa fa-paperclip" ng-show="message.HasAttachment || message.Attachments.length > 0"></i>
                    <location-tag ng-if="showFrom(message) || showTo(message)"></location-tag>
                    <h4>{{ message.Subject }}</h4>
                    <span ng-repeat="id in message.LabelIDs" class="label label-pm" style="background-color: {{ getLabel(id).Color }}">{{ getLabel(id).Name }}</span>
                </td>
                <td class="size">
                    {{ message.Size | humanSize }}
                </td>
                <td class="when">
                    {{ message.Time | readableTime }}
                </td>
            </tr>
        </tbody>
    </table>
    <table class="visible-xs-block table message-list table-hover mobile" ng-class="{empty: messages.length == 0}">
        <tbody id="message">
            <tr ng-repeat="message in messages" ng-click="navigateToMessage($event, message)" ng-class="{ unread: !message.IsRead, selected: selected, starred: message.Tag == 'starred' }">
                <td class="subject">
                    <h4>
                        <span class="fa {{ message.IsEncrypted == '1' ? 'fa-lock' : 'fa-unlock-alt' }}" pt-tooltip="{{ message.IsEncrypted == '1' ? 'Encrypted' : 'Not encrypted' }}">
                        </span>{{ message.Subject }}
                    </h4>
                    <div class="recipient" ng-switch="('secured.sent' | isState) || ('secured.drafts' | isState)">
                        <span ng-if="showTo(message)">
                            <span class="to">
                                To: </span>{{ message.ToList | username }}
                            </span>
                        </span>
                        <span ng-if="showFrom(message) && !showTo(message)">
                            <span class="from">
                                From: </span>{{ message.SenderName }}
                            </span>
                        </span>
                        <span ng-if="!showTo(message) && !showFrom(message)">
                            <span pt-tooltip="{{ message.SenderAddress }}">
                                {{ message.SenderName }}
                            </span>
                        </span>
                        <span class="pull-right">{{ message.Time | readableTime }}</span>
                        <span class="sender" ng-switch-default>{{ message.Sender }}</span>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <div id="noMessages" ng-if="messages.length == 0">
        <span ng-show="!('secured.search' | includedByState)">{{ 'NO_MESSAGES' | translate }}</span>
        <span ng-show="('secured.search' | includedByState)">{{ 'NO_SEARCH_RESULTS' | translate }}</span>
    </div>
    <div id="pageBottom"></div>
</div>
