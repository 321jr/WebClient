<ng-include src="'templates/partials/messageViewToolbar.tpl.html'" class="message-view-toolbar"></ng-include>
<div class="row visible-xs-block" id="messageActionsMobile">
    <div class="col-xs-4" ng-click="reply(message)"><a href class="btn btn-link"><i class="fa fa-reply"></i> Reply</a></div>
    <div class="col-xs-4" ng-click="replyAll(message)"><a href class="btn btn-link"><i class="fa fa-reply-all"></i> Reply All</a></div>
    <div class="col-xs-4" ng-click="forward(message)"><a href class="btn btn-link"><i class="fa fa-mail-forward"></i> Forward</a></div>
</div>
<div class="message-head" ng-class="{ unread:!message.IsRead, starred: message.Tag == 'starred' }">
    <div class="pull-right">
        <span btf-markdown="message.longReadableTime() | contrast:'('"></span>
    </div>
    <h1>
        <a href class="star" ng-click="message.toggleStar()"><i class="fa {{ (message.Tag == 'starred') ? 'fa-star' : 'fa-star-o' }}"></i></a>
        <span class="padlock">
            <i class="fa"
            ng-class=
            "{
              'fa-lock':
                !!!(message.IsEncrypted == '0'),
              'text-purple':
                !!(message.IsEncrypted == '1') ||
                !!(message.IsEncrypted == '5') ||
                !!(message.IsEncrypted == '6'),
              'fa-unlock-alt text-muted':
                !!(message.IsEncrypted == '0')
            }"
            title="{{ getMessageEncryptionType(message) }}"></i>
        </span>
        {{ message.MessageTitle }}
        <span class="label label-pm" style="background-color: {{label.LabelColor}}" ng-repeat="label in message.Labels">
            {{label.LabelName}} <a href="" ng-click="detachLabel(label)"><i class="fa fa-times text-muted"></i></a>
        </span>
      </h1>
    <ul class="infos">
        <li>
            <strong>From</strong>
            <i class="fa fa-lock text-purple" ng-if="tools.isEmailAddressPM(message.Sender)"></i>
            <b>{{message.SenderName}}</b> <{{message.Sender}}>
        </li>
        <li>
            <strong>To</strong>
            <ul class="list-inline inline">
                <li ng-repeat="email in message.RecipientList.split(',')">
                    <a href="" class="email" ng-click="sendMessageTo(email)" pt-tooltip="Compose to"><i ng-show="tools.isEmailAddressPM(email)" class="fa fa-lock text-purple"></i> {{ email }}</a>
                </li>
            </ul>
        </li>
        <li ng-if="message.CCList">
            <strong>CC</strong>
            <span btf-markdown="message.CCList | contrast:'<'"></span>
            <ul class="list-inline inline">
                <li ng-repeat="email in message.CCList.split(',')">
                    <a href="" class="email" ng-click="sendMessageTo(email)" pt-tooltip="Compose to"><i ng-show="tools.isEmailAddressPM(email)" class="fa fa-lock text-purple"></i> {{ email }}</a>
                </li>
            </ul>
        </li>
        <li ng-if="message.BCCList">
            <strong>BCC</strong>
            <ul class="list-inline inline">
                <li ng-repeat="email in message.BCCList.split(',')">
                    <a href="" class="email" ng-click="sendMessageTo(email)" pt-tooltip="Compose to"><i ng-show="tools.isEmailAddressPM(email)" class="fa fa-lock text-purple"></i> {{ email }}</a>
                </li>
            </ul>
        </li>
    </ul>
</div>
<!--/.message-head-->
<div class="col-md-12">
    <ul ng-if="message.AttachmentIDList.length" class="attachments">
        <li ng-repeat="attachment in message.AttachmentIDList">
            <i class="fa fa-paperclip"></i>
            <a href="" ng-click="downloadAttachment(attachment)"><strong>{{ attachment.FileName }}</strong></a> <em>{{attachment.FileSize | humanSize}}</em>
        </li>
    </ul>
</div>
<div class="col-md-12" ng-show="message.containsImage === true">
    <p class="alert alert-warning alert-sm text-center" ng-show="!!message.imagesHidden">
        <a href="" ng-click="message.toggleImages()">
            <span ng-show="!!message.imagesHidden">Show Images</span>
            <span ng-hide="!!message.imagesHidden">Hide Images</span>
        </a>
    </p>
</div>
<div id="message-body">
    <iframe src="" ng-init="message.viewMode = 'html'" ng-show="message.viewMode === 'html' && message.clearTextBody() != ''" sandbox="allow-same-origin allow-popups"></iframe>
    <code ng-show="message.viewMode === 'plain'" ng-bind="message.plainText()"></code>
    <div class="alert alert-danger clearfix" role="alert" ng-if="message.clearTextBody() == '' && message.failedDecryption">
        <span class="pull-left fa fa-exclamation-triangle"></span>
        <strong>Decryption error</strong>
        <br> Decryption of this message's encryption content failed.
    </div>
    <hr />
    <div class="col-md-12 form-group">
        <a href="" ng-click="reply(message)">Reply</a>, <a href="" ng-click="replyAll(message)">Reply All</a> or <a href="" ng-click="forward(message)">Forward</a>
    </div>
</div>
