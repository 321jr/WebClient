<!DOCTYPE html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>ProtonMail</title>
<meta property="og:image" content="//protonmail.ch/img/facebook_logo.jpg"/>
<meta property="og:title" content="Encrypted email, based in Switzerland."/>
<meta property="og:url" content="//protonmail.ch"/>
<meta property="og:site_name" content="ProtonMail"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="mobile-web-app-capable" content="yes">
<?php if (isset($_SESSION['UserID'])) : ?>
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />
<?php endif; ?>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.json">
<link rel="icon" sizes="192x192" href="/img/android/launcher-icon-4x.png">
<?php include(__DIR__.'/../../assets/_style.php'); ?>

<?php if(isset($_SESSION['theme_txt']) && $page!=='locked') : ?>
<style type="text/css" id="custom_theme"><?php echo trim(Utilities::clean_css($_SESSION['theme_txt'])); ?></style>
<?php endif;?>

<noscript>
<meta http-equiv="Refresh" CONTENT="0; URL=/js">
</noscript>
<?php 
if (isset($page)) {$headerPage = str_replace('Page', '', $page); $headerPage = lcfirst($headerPage); }
else {$headerPage = ''; }
if (!isset($baseFileName)) { $baseFileName = ''; }
if (!isset($currentPage)) { $currentPage = ''; }
?>
</head>
<body id="page-<?php echo strip_tags($baseFileName); ?>" class="<?php
if (isset($listingPage)&&$listingPage==true) echo 'listing';
echo ' e2e'
?>">

<?php if (isset($_SESSION['UserID'])) : ?>
<script type="text/javascript">
if (sessionStorage.protonmail_pw === undefined) {
	var open_pages = <?php echo json_encode(unserialize(OPEN_PAGES)); ?>;
	var page_name = document.getElementsByTagName('body')[0].getAttribute('id').replace(/^page-/,'');
	if (page_name !== 'locked' && (open_pages.indexOf(page_name) < 0)) {
		window.location = '/locked';
	}
}
</script>
<?php endif; ?>

<input type='hidden' id='currentPage' name='currentPage' value='<?php echo clean_key_for_enc_message_id($currentPage); ?>'>


<div class="page full" id="main">
<?php 
include(__DIR__.'/nav.php');
// Listings Header
if (  (isset($message_array) && is_array($message_array)) ||
    (isset($_SESSION['FilterUnread'])) && isset($page) && (in_array($page, array('inbox', 'draft', 'outbox', 'trash', 'starred', 'spam', 'search'))))
{
    if (count($message_array) > 0 || isset($_SESSION['FilterUnread'])) {
        include(__DIR__ . '/listing-actions.php');
    } else {
        echo "<div class='header'></div>";
    }
}

// IF ATTACHMENTS EXISTS, GIVE MIDDLE A CLASS
$attachmentsExist = (isset($message['AttachmentIDList']) && strlen($message['AttachmentIDList'])>1) ? true : false; ?>
<?php if (isset($page)&&$page!=='m') : ?>
<div id="middle" class="<?php if($attachmentsExist) echo 'att';?>">
<?php endif; ?>
<input type='hidden' id='currentPage' name='currentPage' value='<?php echo clean_key($currentPage); ?>'> 
<?php 
// Message Actions and MainHeader
if (isset($page)&&$page=='m') : ?>
<?php if (!empty($flash['error'])) display($flash['error'], 0); ?>
<?php if (!empty($flash['success'])) display($flash['success'], 1); ?>
<?php include(__DIR__.'/message-actions.php'); ?>
<?php
if ($message['ExpirationTime'] > 0 && (is_email_expired($message['Time'], $message['ExpirationTime']))) {
    if (Message::delete_message($_SESSION['UserID'], $message['MessageID'])) {
        $cache = new RedisCache();
        $cache->cache_delete_message($_SESSION['UserID'], $message['MessageID']);
    }
}
$page = preg_replace('#[^a-zA-Z_]#', '', basename($_SERVER["SCRIPT_FILENAME"], '.php'));
?>
<div class="contentHeader wrap <?php if ($message['Tag']=='starred') echo 'starred'; ?>" id="primaryHeader">
<form action="/m/<?php echo encrypt_message_id($message["MessageID"]); ?>" name='message_operator' method='post' id="MAB">
  <ul>
    <li class="message-response-links"><button class='pure-button pure-button-primary' type='submit' title="Reply" name='reply'>
      <i class='fa fa-reply'></i>
      <strong>Reply</strong>
    </button></li>
    <li class="message-response-links"><button class='pure-button pure-button-primary' type='submit' title="Reply All" name='reply_to_all'>
      <i class='fa fa-reply-all'></i>
      <strong>Reply All</strong>
    </button></li>
    <li class="message-response-links"><button class='pure-button pure-button-primary' type='submit' title="Forward" name='forward'>
      <i class='fa fa-mail-forward'></i>
      <strong>Forward</strong>
    </button></li>
  </ul>
</form>
<div id="titleBar">
<?php $AttachmentIDArray = address_list_to_array($message["AttachmentIDList"]); ?>
<h1 class="email-content-title">
<?php if ($message['Tag']=='starred') : ?>
<i class="fa fa-star" data-message-id="<?php echo encrypt_message_id($message["MessageID"]); ?>"></i>
<?php else : ?>
<i class="fa fa-star-o" data-message-id="<?php echo encrypt_message_id($message["MessageID"]); ?>"></i>
<?php endif; ?> 
<?php 
if ($message['IsReplied'] && !$message['IsRepliedAll']) echo " <i class='lighter fa fa-mail-reply' title='Replied'></i>";
if ($message['IsRepliedAll']) echo " <i class='lighter fa fa-mail-reply-all' title='Replied to All'></i>";
if ($message['IsForwarded']) echo " <i class='lighter fa fa-mail-forward' title='Forwarded'></i>";
echo renderLock($message["IsEncrypted"]);
echo strip_tags($message['MessageTitle']); 
if (count($AttachmentIDArray)>0) :?>
<span class="fa fa-paperclip" title="Contains Attachments"></span>
<?php endif;
if ($message["ExpirationTime"]!=0) {
  $timeLeft = time_left($message['Time'], $message['ExpirationTime']);
  echo "<span class='fa fa-clock-o' title='Expiring Email'>";
    echo "<span class='expiretip hide'>";
      echo "<strong class='day'><i>".$timeLeft['d']."</i><em>d</em></strong> ";
      echo "<strong class='hrs'><i>".$timeLeft['h']."</i><em>h</em></strong> ";
      echo "<strong class='min'><i>".$timeLeft['m']."</i><em>m</em></strong> ";
      echo "<strong class='sec'><i>".$timeLeft['s']."</i><em>s</em></strong>";
    echo "</span>";
  echo "</span>"; 
}
?>
<a href="#" id="mobileMore" class="hide"><i class="fa fa-caret-down"></i></a>
<?php
if (count($labels)>0) {
  foreach ($labels as $label) {
    echo '<span class="pmlabel" style="background-color:'.$label['LabelColor'].'">'.Utilities::htmlspecial($label['LabelName']).'<a href="#" class="removeLabel fa fa-close" data-message-id="'.encrypt_message_id($message['MessageID']).'" data-label-id="'.encrypt_message_id($label['LabelID']).'"></a></span>';
  }
}
?>
</h1>
</div><!--/#titleBar-->
</div><!--/#contentHeader-->
<div id="emailFrame">
<div class="email-content-subtitle" id="message-metadata"> 
<span id="message-time">
  <strong class="timezone2"><?php echo $message["Time"]; ?></strong>
  <input type="hidden" id="messageTime" value="<?php echo $message["Time"]; ?>" >
  <em>(<?php echo time_elapsed_string($message["Time"]); ?>)</em>
</span>
<table class="pure-table">
<tbody>
<tr>
<th id="fromTh"><span>From</span></th>
<td class="fromTD">
<?php
echo '<strong><span>'.output_sender_name(empty($message['SenderName']) ? get_name_from_email($message['Sender']) : $message['SenderName']).'</span>';
echo ' <em>&lt;'.output_email_list($message['Sender'], 200).'&gt;</em>';
if ($message['IsEncrypted']==Encryption::OutEncReply) {
  echo " via ProtonMail";
}
?>
</strong>
<span id="dkim">
<?php
if ($message['IsEncrypted']==Encryption::Internal || $message['IsEncrypted']==Encryption::OutEncReply) {
echo '<span class="fa fa-check-circle verified" title="ProtonMail Verified"></span> <span class="fa fa-lock" title="ProtonMail Secured"></span>';
} 
elseif(is_valid_dkim($message['Header'])){ 
echo '<span class="fa fa-check-circle verified" title="DKIM is Valid"></span>';
}?>
</span><!--/#dkim-->
</td>
</tr>
<?php
// RecipientList
if (count($message['RecipientList']) > 0) :
//$RecipientList = explode(",", strip_tags($message['RecipientList']));
//$RecipientNameList = explode(",", $message['RecipientNameList']);
?>
<tr>
<th><span>To</span></th>
<td>
<?php echo renderBubble($message['RecipientList']); ?>
</td>
</tr>
<?php endif; ?>
<?php if (count($message['CCList']) > 0) : ?>
<tr>
<th><span>CC</span></th>
<td>
<?php echo renderBubble($message['CCList']); ?>
</td>
</tr>
<?php endif; ?>
<?php if (count($message['BCCList']) >0 && $message['Location']==2) : ?>
<tr>
<th><span>BCC</span></th>
<td>
<?php echo renderBubble($message['BCCList']); ?>
</td>
</tr>
<?php endif; ?>
</tbody>
</table>
</div><!--/.email-content-subtitle-->
<div class="clear"></div>
<?php endif; ?> 

<div id="middle" class="wrap"> 
<div class="panel panel-bordered">
	<h1>Why ProtonMail?</h1>
	<p class="alert">Under construction while we finish core services.</p></div>
</div>
</div>

</div><!--/.container-->

<section id="footer">
    <div class="container">
        <ul>
            <li class="header">Learn More</li>
            <li><a href="https://blog.protonmail.ch/protonmail-threat-model/">Threat Model</a></li>
            <li><a href="/pages/why-protonmail">Why ProtonMail?</a></li>
            <li><a href="/pages/press">Press</a></li>
            <li><br></li>
        </ul>
        <ul>
            <li class="header">Support</li>
            <li><a href="https://protonmail.uservoice.com">Request Feature</a></li>
            <li><a href="https://support.protonmail.ch">Knowledge Base</a></li>
            <li><a href="/report-bug">Report Bug</a></li>
        </ul>
        <ul>
            <li class="header">Company</li> 
            <li><a href="/pages/media">Media Kit</a></li>
            <li><a href="/pages/about#about-team">Our Team</a></li>
            <li><a href="https://blog.protonmail.ch">Blog</a></li>
        </ul>
        <ul id="latestNews">
            <li class="header">Latest News</li>
            <li><a href="https://blog.protonmail.ch/protonmail-at-ted-global/"><strong>ProtonMail at TED Global</strong></a></li>                
            <li><a href="https://blog.protonmail.ch/protonmail-beta-v1-14-release-notes/"><strong>ProtonMail BETA v1.14 Release Notes</strong></a></li>
            <li><a href="https://blog.protonmail.ch/privacy-under-attack/"><strong>Why Privacy Is Under Attack</strong></a></li>
        </ul>
        <div class="clear"></div>        
    </div>
</section>

<section id="bottom">
    <div class="container">
        <p class="copy pull-left">&copy; 2015 Proton Technologies AG. <span>All Rights Reserved.</span></p>
        <p class="links">
            <a href="/">Home</a> |
            <a href="/login">Sign In</a> |
            <a href="/donate">Donate</a> | 
            <a href="/pages/careers"><strong>We're Hiring!</strong></a> | 
            <a href="/pages/privacy-policy">Privacy<span> Policy</span></a> | 
            <a href="/pages/terms-and-conditions">Terms<span> &amp; Conditions</span></a>    
            <a class="social" href="https://fb.com/protonmail"><i class="fa fa-facebook"></i></a>
            <a class="social" href="https://twitter.com/protonmail"><i class="fa fa-twitter"></i></a>                
        </p>
        <div class="clear"></div>
    </div>
</section>

<script type="text/javascript">

// Support Dropdown Menu
var navSupport = document.getElementById('nav-support');
if (navSupport!==null) {
    navSupport.addEventListener("click",function(e){
        document.getElementById('subNav').classList.toggle('hide');
    },false);
}

// Mobile / Tablet Dropdown Menu
document.getElementById('mobileMenuLink').addEventListener("click",function(e){
    document.getElementsByTagName('body')[0].className = 'dropdown';
    return false;
},false);

// Detect is JS is enabled
var elems = document.querySelectorAll("html");
[].forEach.call(elems, function(el) {
    el.classList.remove("no-js");
});
</script>

<script type="text/javascript" defer>
var script = document.createElement('script');
script.src = "/ext.js";
document.getElementsByTagName('head')[0].appendChild(script);
</script>

<!-- Piwik -->
<script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setCookieDomain", "*.protonmail.ch"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//stats.protonmail.ch/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<noscript id="piwik-pixel"><p><img src="//stats.protonmail.ch/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

</body>
</html>